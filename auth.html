<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Confirmando…</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="authwrap">
    <div class="authcard">
      <div class="brand" style="margin-bottom:14px;">
        <div class="brand__mark">E</div>
        <div class="brand__text">
          <div class="brand__name">Confirmando acesso…</div>
          <div class="brand__tag">Aguarde</div>
        </div>
      </div>
      <pre class="console" id="console">Processando…</pre>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabase-config.js"></script>
  <script>
    const consoleEl = document.getElementById("console");
    const sb = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY, {
      auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }
    });

    (async () => {
      try{
        // Se o Supabase trouxe tokens na URL, ele cria a sessão automaticamente.
        const { data } = await sb.auth.getSession();
        consoleEl.textContent = data?.session ? "Confirmado ✅ Redirecionando…" : "Link inválido ou expirado.";
        setTimeout(() => location.href = "./login.html", 1000);
      }catch(e){
        consoleEl.textContent = "Erro: " + e.message;
      }
    })();
  </script>
</body>
</html>
